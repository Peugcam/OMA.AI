# ğŸ¯ Modelo HÃ­brido - ConfiguraÃ§Ã£o Completa

## ğŸ“Š EstratÃ©gia de Custo Otimizada

**80% Stock Videos (GrÃ¡tis) + 20% Stability AI (Pago)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CUSTO POR VÃDEO: $0.0254                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Com $0.06 vocÃª faz: 2-3 vÃ­deos                  â”‚
â”‚ Qualidade esperada: 9.5/10 â­                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¬ Como Funciona o Fluxo HÃ­brido

### Visual Agent - Fluxo de DecisÃ£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Visual Agent (Gemma 2 9B)                               â”‚
â”‚ Analisa cena e gera keywords                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cena: "Modern coffee shop interior, warm lighting"      â”‚
â”‚ Keywords: ["coffee shop", "modern interior", "cozy"]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” STEP 1: Buscar em Pexels API (GRÃTIS)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”œâ”€ ENCONTROU (80% dos casos)
              â”‚  â””â”€â”€> âœ… USA VÃDEO DO PEXELS (custo: $0)
              â”‚
              â””â”€ NÃƒO ENCONTROU (20% dos casos)
                 â”‚
                 v
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ ğŸ¨ STEP 2: Gerar com Stability AI       â”‚
              â”‚ Fallback quando Pexels nÃ£o tem conteÃºdo â”‚
              â””â”€â”€> ğŸ’µ USA STABILITY AI ($0.04)
```

---

## ğŸ”§ ConfiguraÃ§Ã£o Passo a Passo

### 1. Obter API Keys (1 GrÃ¡tis + 1 Paga)

#### 1.1 Pexels API (GRÃTIS) âœ…

1. Acesse: https://www.pexels.com/api/
2. Clique em **"Get Started"**
3. Crie conta grÃ¡tis
4. Copie sua **API Key**

**Limite:**
- 200 requests/hora (GRÃTIS)
- HD videos ilimitados
- Sem watermark

#### 1.2 Stability AI (PAGA) ğŸ’µ

1. Acesse: https://platform.stability.ai/
2. Clique em **"Sign Up"**
3. Adicione crÃ©ditos ($10 mÃ­nimo)
4. Copie sua **API Key**

**Custo:**
- $0.040 por imagem (SDXL 1024x1024)
- Usado apenas como fallback (20% dos casos)

---

### 2. Configurar `.env`

```bash
# ============================================================================
# OpenRouter API (LLMs) - OBRIGATÃ“RIO
# ============================================================================

OPENROUTER_API_KEY=sk-or-v1-xxxxxxxxxxxxxxxxxxxxx

# Modelos (5 agents via OpenRouter)
SUPERVISOR_MODEL=qwen/qwen-2.5-7b-instruct       # $0.09/1M tokens
SCRIPT_MODEL=microsoft/phi-3.5-mini-128k         # $0.10/1M tokens
VISUAL_MODEL=google/gemma-2-9b-it                # $0.20/1M tokens
AUDIO_MODEL=mistralai/mistral-7b-instruct-v0.3   # $0.06/1M tokens
EDITOR_MODEL=meta-llama/llama-3.2-3b-instruct    # $0.06/1M tokens

# ============================================================================
# Stock Videos (GRÃTIS) - RECOMENDADO
# ============================================================================

# Pexels (vÃ­deos HD grÃ¡tis)
PEXELS_API_KEY=your-pexels-api-key-here

# ============================================================================
# Stability AI (Fallback) - OPCIONAL
# ============================================================================

STABILITY_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx

# Habilitar fallback para Stability AI quando Pexels nÃ£o encontrar
STABILITY_FALLBACK_ENABLED=true
```

---

## ğŸ’° Breakdown de Custos Detalhado

### Por VÃ­deo de 30s (3 cenas)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPONENTE           â”‚ CUSTO    â”‚ % DO TOTAL        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LLMs (5 agents)      â”‚ $0.00068 â”‚ 2.7%              â”‚
â”‚ Pexels (2.4 cenas)   â”‚ $0.00000 â”‚ 0%   (GRÃTIS) âœ…  â”‚
â”‚ Stability (0.6 imgs) â”‚ $0.02400 â”‚ 97.3% (fallback)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                â”‚ $0.02540 â”‚ 100%              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Breakdown dos LLMs ($0.00068)

| Agent | Modelo | Tokens | Custo |
|-------|--------|--------|-------|
| Supervisor | Qwen 2.5 7B | 800 | $0.000072 |
| Script | Phi-3.5 Mini | 2000 | $0.000200 |
| Visual | Gemma 2 9B | 1500 | $0.000300 |
| Audio | Mistral 7B | 800 | $0.000048 |
| Editor | Llama 3.2 3B | 1000 | $0.000060 |
| **TOTAL** | | **6100** | **$0.000680** |

### Breakdown do Stock + Stability

**VÃ­deo tÃ­pico = 3 cenas:**

| Cena | Source | Tentativa | Custo | Nota |
|------|--------|-----------|-------|------|
| Cena 1 | Pexels | 1Âª tentativa | $0.00 | "coffee shop interior" âœ… |
| Cena 2 | Pexels | 1Âª tentativa | $0.00 | "barista making coffee" âœ… |
| Cena 3 | Stability | 2Âª tentativa | $0.04 | "abstract tech logo" ğŸ¨ |

**Total mÃ©dia: 2.4 cenas do stock (80%) + 0.6 imagens Stability (20%)**

---

## ğŸ“ˆ SimulaÃ§Ã£o: Com $0.06 no Bolso

### CenÃ¡rio Real

```
Budget: $0.06
Custo/vÃ­deo: $0.0254

VÃ­deos possÃ­veis: $0.06 / $0.0254 = 2.36 vÃ­deos
```

**VocÃª consegue fazer:**
- âœ… **2 vÃ­deos completos** ($0.0508)
- âœ… Sobram **$0.0092** (36% de outro vÃ­deo)

**Comparado com:**

| Abordagem | Custo/vÃ­deo | VÃ­deos com $0.06 | Qualidade |
|-----------|-------------|------------------|-----------|
| **HÃ­brido (80% stock)** | **$0.0254** | **2-3** | **9.5/10** â­ |
| Stock 100% | $0.0014 | 42 | 8.5/10 |
| Stability 100% | $0.1214 | 0.5 | 10/10 |
| GPT-4o + Claude | $0.0355 | 1.7 | 10/10 |

---

## ğŸ¯ Quando Usar Cada Source

### Pexels (Prioridade 1) - 80% dos casos

**Melhor para:**
- âœ… Locais genÃ©ricos (coffee shop, office, city)
- âœ… Pessoas em aÃ§Ã£o (working, talking, walking)
- âœ… Natureza (beach, forest, sunset)
- âœ… Business (meetings, presentations)
- âœ… Lifestyle (cooking, exercising, family)
- âœ… Technology (laptops, coding, devices)

**Exemplos:**
```json
{
  "keywords": ["modern office interior", "business meeting", "laptop work"],
  "found_in_pexels": true,
  "cost": 0
}
```

### Stability AI (Fallback) - 20% dos casos

**Melhor para:**
- âœ… Conceitos abstratos (creativity, innovation, future)
- âœ… Logos customizados
- âœ… VisualizaÃ§Ãµes Ãºnicas
- âœ… Quando stock nÃ£o encontra nada

**Exemplos:**
```json
{
  "keywords": ["futuristic AI brain hologram", "quantum computing visualization"],
  "found_in_pexels": false,
  "generated_with_stability": true,
  "cost": 0.04
}
```

---

## ğŸ” ImplementaÃ§Ã£o do Visual Agent

### CÃ³digo Exemplo

```python
import os
import requests
from typing import Optional, Dict

class HybridVisualAgent:
    """Visual Agent com fallback Pexels â†’ Stability"""

    def __init__(self):
        self.pexels_key = os.getenv("PEXELS_API_KEY")
        self.stability_key = os.getenv("STABILITY_API_KEY")
        self.stability_enabled = os.getenv("STABILITY_FALLBACK_ENABLED", "true").lower() == "true"

    async def get_visual_for_scene(self, keywords: list) -> Dict:
        """
        Busca visual com estratÃ©gia hÃ­brida

        Returns:
            {
                "source": "pexels" | "stability",
                "url": str,
                "cost": float,
                "attempts": int
            }
        """
        # STEP 1: Tentar Pexels
        if self.pexels_key:
            result = await self._search_pexels(keywords)
            if result:
                return {
                    "source": "pexels",
                    "url": result["url"],
                    "cost": 0.0,
                    "attempts": 1
                }

        # STEP 2: Fallback para Stability AI
        if self.stability_enabled and self.stability_key:
            result = await self._generate_stability(keywords)
            return {
                "source": "stability",
                "url": result["url"],
                "cost": 0.04,  # SDXL 1024x1024
                "attempts": 2
            }

        # Fallback final: retornar None
        return None

    async def _search_pexels(self, keywords: list) -> Optional[Dict]:
        """Busca vÃ­deo no Pexels"""
        query = " ".join(keywords)

        response = requests.get(
            "https://api.pexels.com/videos/search",
            headers={"Authorization": self.pexels_key},
            params={"query": query, "per_page": 1, "orientation": "landscape"}
        )

        if response.status_code == 200:
            data = response.json()
            if data.get("videos"):
                video = data["videos"][0]
                return {
                    "url": video["video_files"][0]["link"],
                    "id": video["id"],
                    "duration": video["duration"]
                }

        return None

    async def _generate_stability(self, keywords: list) -> Dict:
        """Gera imagem com Stability AI"""
        prompt = ", ".join(keywords)

        response = requests.post(
            "https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image",
            headers={
                "Authorization": f"Bearer {self.stability_key}",
                "Content-Type": "application/json"
            },
            json={
                "text_prompts": [{"text": prompt}],
                "cfg_scale": 7,
                "height": 1024,
                "width": 1024,
                "samples": 1,
                "steps": 30
            }
        )

        if response.status_code == 200:
            data = response.json()
            return {
                "url": data["artifacts"][0]["base64"],
                "format": "base64"
            }

        raise Exception(f"Stability AI failed: {response.text}")
```

---

## ğŸ“Š Monitoramento de Custos

### Dashboard Gradio - Tracking por Source

Adicione ao `dashboard.py`:

```python
def get_visual_sources_breakdown():
    """Mostra breakdown de sources usadas"""

    # Query do state_manager
    stats = {
        "pexels": {"count": 0, "cost": 0.0},
        "pixabay": {"count": 0, "cost": 0.0},
        "stability": {"count": 0, "cost": 0.0}
    }

    # ... query implementation

    return f"""
# ğŸ¨ Visual Sources Breakdown

## Usage
- **Pexels:** {stats['pexels']['count']} cenas (${stats['pexels']['cost']:.2f})
- **Pixabay:** {stats['pixabay']['count']} cenas (${stats['pixabay']['cost']:.2f})
- **Stability AI:** {stats['stability']['count']} imagens (${stats['stability']['cost']:.2f})

## Total
- **Scenes/Images:** {sum(s['count'] for s in stats.values())}
- **Total Cost:** ${sum(s['cost'] for s in stats.values()):.2f}

## Efficiency
- **Stock Hit Rate:** {((stats['pexels']['count'] + stats['pixabay']['count']) / sum(s['count'] for s in stats.values()) * 100):.1f}%
- **Avg Cost/Scene:** ${sum(s['cost'] for s in stats.values()) / sum(s['count'] for s in stats.values()):.4f}
"""
```

---

## ğŸ¯ Qualidade Esperada: 9.5/10

### Breakdown por Componente

| Componente | Qualidade | Nota |
|------------|-----------|------|
| Script (Phi-3.5 Mini) | Criativo, bom portuguÃªs | 9/10 |
| Visuals (80% stock) | HD profissional | 10/10 |
| Visuals (20% Stability) | Alta qualidade, Ãºnico | 9/10 |
| Audio (Mistral 7B) | Timing adequado | 9/10 |
| EdiÃ§Ã£o (Llama 3.2) | TransiÃ§Ãµes suaves | 9.5/10 |
| **MÃ‰DIA GERAL** | | **9.5/10** â­ |

**Por que 9.5/10 e nÃ£o 10/10?**
- âœ… Stock videos sÃ£o HD profissional
- âœ… Stability AI gera imagens Ãºnicas de alta qualidade
- âœ… LLMs sÃ£o adequados para cada tarefa
- âš ï¸ Alguns conceitos abstratos podem nÃ£o ter match perfeito no stock
- âš ï¸ Stability AI Ã s vezes gera artefatos (5-10% dos casos)

---

## ğŸš€ Quick Start

### Teste o Modelo HÃ­brido Agora

```bash
# 1. Configurar .env
cp .env.example .env
# Adicionar as 3 API keys (Pexels, Pixabay, Stability)

# 2. Instalar dependÃªncias
pip install -r requirements_openrouter.txt

# 3. Testar fluxo hÃ­brido
python test_hybrid_visual.py

# 4. Criar vÃ­deo de teste
python create_video.py --title "Test Video" --duration 30
```

---

## ğŸ“ Checklist de ConfiguraÃ§Ã£o

- [ ] âœ… OpenRouter API key configurada (LLMs)
- [ ] âœ… Pexels API key configurada (stock grÃ¡tis)
- [ ] âš ï¸ Stability API key configurada (fallback pago)
- [ ] âœ… `STABILITY_FALLBACK_ENABLED=true`
- [ ] âœ… Testar fluxo com vÃ­deo de exemplo

---

## ğŸ’¡ Dicas de OtimizaÃ§Ã£o

### Reduzir Uso de Stability AI

1. **Melhorar keywords do Visual Agent**
   - Keywords mais especÃ­ficas aumentam hit rate no stock
   - Ex: "modern minimalist office" vs "office"

2. **Usar keywords mais genÃ©ricas**
   - Preferir termos genÃ©ricos aumenta hit rate
   - Ex: "office" vs "quantum computing lab"

3. **Cachear resultados**
   - Salvar keywords â†’ video_url mapping
   - Evita re-buscar mesmos conceitos

4. **Priorizar conceitos genÃ©ricos**
   - Preferir "business meeting" vs "quantum computing hologram"
   - Stock tem muito conteÃºdo genÃ©rico

---

## ğŸ‰ Resultado Final

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MODELO HÃBRIDO - RESUMO                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Custo/vÃ­deo:        $0.0254                     â”‚
â”‚ VÃ­deos com $0.06:   2-3                         â”‚
â”‚ Qualidade:          9.5/10 â­                    â”‚
â”‚ Stock grÃ¡tis:       80% (Pexels)                â”‚
â”‚ Stability AI:       20% (fallback)              â”‚
â”‚ LLMs:               100% OpenRouter API         â”‚
â”‚                                                 â”‚
â”‚ âœ… Custo otimizado                              â”‚
â”‚ âœ… Alta qualidade                               â”‚
â”‚ âœ… EscalÃ¡vel                                    â”‚
â”‚ âœ… Sem vendor lock-in                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**OMA.AI** - Qualidade profissional com custo otimizado! ğŸš€
